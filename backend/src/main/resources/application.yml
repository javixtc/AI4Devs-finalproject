# Meditation Builder - Main Configuration
# ==========================================

spring:
  application:
    name: meditation-builder
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

# Server Configuration
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api

# AI Configuration metaprompt
ai:
  textMetaprompt: "You are an expert in guided meditation and mindfulness. Improve and enrich the following text so it becomes a clear, soothing, immersive guided‑meditation script, using a soft compassionate tone, short slow‑paced sentences, sensory language, simple instructions, and a natural progression (breath → body → awareness → gentle closure). Keep the original intention while enhancing clarity, calmness, and flow. Improve this content: "
  imageMetaprompt: "You are an expert in meditation and calming visual creation. Generate a peaceful, soothing image based on the following description, using soft colors and minimalistic natural elements to convey serenity: "

# OpenAI Configuration
openai:
  base-url: ${OPENAI_BASE_URL:https://api.openai.com}
  api-key: ${OPENAI_API_KEY:}

  text:
    model: ${OPENAI_TEXT_MODEL:gpt-5-nano}
    temperature: ${OPENAI_TEMPERATURE:1.0}
    max-completion-tokens: ${OPENAI_MAX_TOKENS:1024}
    top-p: ${OPENAI_TOP_P:1.0}
    frequency-penalty: ${OPENAI_FREQUENCY_PENALTY:0.0}
    presence-penalty: ${OPENAI_PRESENCE_PENALTY:0.0}

  image:
    model: ${OPENAI_IMAGE_MODEL:gpt-image-1-mini}
    size: ${OPENAI_IMAGE_SIZE:1024x1024}
    quality: ${OPENAI_IMAGE_QUALITY:low}
    # Para GPT Image (se usan solo si el modelo empieza por gpt-image)
    output-format: ${OPENAI_IMAGE_OUTPUT_FORMAT:png}
    background: ${OPENAI_IMAGE_BACKGROUND:auto}
    # Para DALL·E (se usa solo si el modelo empieza por dall-e)
    response-format: ${OPENAI_IMAGE_RESPONSE_FORMAT:url} # url | b64_json
    n: ${OPENAI_IMAGE_N:1}

# Media Catalog Service Configuration
media-catalog:
  base-url: ${MEDIA_CATALOG_URL:http://localhost:8081}
  connect-timeout-ms: ${MEDIA_CATALOG_CONNECT_TIMEOUT:5000}
  read-timeout-ms: ${MEDIA_CATALOG_READ_TIMEOUT:10000}

# Retry Configuration
retry:
  max-attempts: ${RETRY_MAX_ATTEMPTS:3}
  initial-interval-ms: ${RETRY_INITIAL_INTERVAL:1000}
  multiplier: ${RETRY_MULTIPLIER:2.0}
  port: ${SERVER_PORT:8080}

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true
  tracing:
    sampling:
      probability: ${OTEL_SAMPLING_PROBABILITY:1.0}
  otlp:
    tracing:
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318/v1/traces}
    metrics:
      endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4318/v1/metrics}

# FFmpeg Configuration
ffmpeg:
  path: ${FFMPEG_PATH:ffmpeg}
  enable-fallback: ${FFMPEG_ENABLE_FALLBACK:true}

# Google Cloud Text-to-Speech Configuration
google-cloud:
  tts:
    # Enable/disable Google Cloud TTS (if false, uses FFmpeg silent audio fallback)
    enabled: ${GOOGLE_TTS_ENABLED:false}
    # Path to Google Cloud credentials JSON file
    credentials-path: ${GOOGLE_APPLICATION_CREDENTIALS:C:/Github copilot/meditation-487517-ce210ad855ee.json}
    # Alternative: Base64-encoded credentials JSON (for containerized environments)
    credentials-json: ${GOOGLE_CREDENTIALS_JSON:}
    # Default voice configuration
    voice:
      language-code: ${GOOGLE_TTS_LANGUAGE:es-ES}
      name: ${GOOGLE_TTS_VOICE_NAME:es-ES-Standard-B}  # Female: A, Male: B, C, D
      gender: ${GOOGLE_TTS_GENDER:MALE}  # MALE, FEMALE, NEUTRAL
    # Audio configuration
    audio:
      encoding: ${GOOGLE_TTS_ENCODING:MP3}  # MP3, LINEAR16, OGG_OPUS
      sample-rate: ${GOOGLE_TTS_SAMPLE_RATE:48000}
      speaking-rate: ${GOOGLE_TTS_SPEAKING_RATE:0.85}  # 0.25 to 4.0 (slower for meditation)
      pitch: ${GOOGLE_TTS_PITCH:0.0}  # -20.0 to 20.0
      volume-gain-db: ${GOOGLE_TTS_VOLUME:0.0}  # -96.0 to 16.0

# Logging Configuration
logging:
  level:
    root: INFO
    com.hexagonal.meditationbuilder: DEBUG
    # FFmpeg adapters - enable to debug rendering issues
    com.hexagonal.meditation.generation.infrastructure.out.adapter.ffmpeg: DEBUG
    # Never log AI prompts or responses (security)
    com.hexagonal.meditationbuilder.infrastructure.out.service: WARN

# Identity BC Configuration
identity:
  jwt:
    # HS256 signing secret — set IDENTITY_JWT_SECRET env var in production (min 32 chars)
    secret: ${IDENTITY_JWT_SECRET:change-me-in-production-minimum-32-chars!!}
  google:
    # Google public JWKS endpoint for id_token verification
    jwks-uri: ${IDENTITY_GOOGLE_JWKS_URI:https://www.googleapis.com/oauth2/v3/certs}

